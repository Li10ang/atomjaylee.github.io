---
title: 博客的持续部署问题
date: 2016-11-03 12:34:50
tags:
  - blog
  - travis ci
  - flow ci
---

当你使用hexo搭建完自己的博客后，可能会有这样的疑问，如果我想写文章但是当时搭建环境的电脑并不在身边怎么办，那么需要你构建一个虚拟的'后台系统'  
这篇文章只说重点，那么你需要注意一下几点：
## 理论
1.持续化集成，持续交付，持续部署是什么？  看这篇文章[谈谈持续集成，持续交付，持续部署之间的区别](http://www.jianshu.com/p/2c6ebe34744a);  
答：白话一下：持续化集成：就是在一个虚拟机中，运行你需要跑的命令(eg:vue的npm run dev等)，然后等成你想要的东西。持续化交付：就是将你生成的东西a传到目标b那去(eg：github-repo)。持续部署：就是将你的目标b，部署到预演环境（XXXXX.github.io)

2.travis ci和flow ci是什么？  
答：其实他们都是负责持续集成和持续部署的工具，比如flow ci标题是这样写的`Hosted Continuous Integration and Delivery Service`,翻译是`托管连续集成和交付服务`。其中flow ci是刚刚出来的，现在还处于beta阶段（我也是刚申请到内测权限），目前阶段是不收费的，我觉得正式发布后，可能和travis ci收费机制相同，基础功能还是免费的。  

3.travis和flow实现的是持续集成和持续交付，那自动部署呢？  
答：我们使用hexo+github来搭建博客系统，就是部署环节。

<!-- more -->
## 工具
1.Travis ci/flow ci.  
2.github 的 token  
3.github 博客所在的仓库

## 开始使用
### travis ci  
1.拿到token：  
![](http://o9z96lbmh.bkt.clouddn.com/%E6%8B%BF%E5%88%B0token.png)
然后点击按钮`Generate new token`，拿到token，记录下来，因为只出现一次  
2.设置travis：  
登录[官网](https://travis-ci.org/),利用github来登录
![](http://o9z96lbmh.bkt.clouddn.com/travis1.png)
![](http://o9z96lbmh.bkt.clouddn.com/travis2.png)
3.设置.travis.yml文件  
``` bash
language: node_js
node_js: stable
# S: Build Lifecycle
install:
  - npm install
#before_script:
 # - npm install -g gulp
cache:
  directories:
    - node_modules

script:
  - hexo g
after_script:
  - cd ./public
  - git init
  - git config user.name "atomjaylee"
  - git config user.email "908105576@qq.com"
  - git add .
  - git commit -m "Update docs"
  - git push --force --quiet "https://${GH_TOKEN}@${GH_REF}" master:master
# E: Build LifeCycle
branches:
  only:
    - source
env:
 global:
   - GH_REF: github.com/atomjaylee/atomjaylee.github.io.git
```
最后，当你把你的新文章提交到source分支的时候，他自己就会自动部署完成。

### flow ci
flow ci和travis ci差不多
![](http://o9z96lbmh.bkt.clouddn.com/flow1.png)
然后在`Custom Script`中，设置和`.travis.yml`文件中相同的配置，就可以了  

## 结尾
现在我们可以异地`git clone`下博客源码分支，然后添加文章之后上传，flow/travis 就能监测到你的代码变化，自动进行集成，交付最后部署到xxx.github.io的网址上去。至此完成
